<!DOCTYPE html>
<html>
<head>
<title>Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body onload = "loadEnter()">
    <body style="background-color:#DDFFF7;"></body>
    <nav>
        <div class="nav-wrapper lighten-2" style="background-color: #202C39">
            <a href="#" class="brand-logo center"><Marquee>F# Twitter Clone</Marquee></a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><button class="btn waves-effect waves-light" type="submit" name="action" id="logouthead" onclick="logout()">Logout</button></li>
            </ul>
        </div>
    </nav>
    
    <div id="main" class="container">
        <br>
        <table class="table container" id="homepage">
            <thead>
                <tr>
                    <th scope="col">Register</th>
                    <th scope="col">Login</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div id ="register">
                            <span class="input-group-text" id="inputGroup-sizing-default">User ID</span>
                            <input type="text" class="form-control" id="runame" name="fname" aria-describedby="inputGroup-sizing-default">
                            <span class="input-group-text" id="inputGroup-sizing-default">Password</span>
                            <input type="password" class="form-control" id="rpass" name="pwd" aria-describedby="inputGroup-sizing-default">
                            
<!--
                            <label for="runame" style="color:#028090; font-family: sans-serif; font-weight: bold; font-size: 12px;">UserID:</label>
                            <input type="text" STYLE="color: #7785AC; font-family: sans-serif; font-weight: bold; font-size: 12px; background-color: #CCD7C5;" id="runame" name="fname"><br><br>
                            <label for="rpass" style="color:#028090; font-family: sans-serif; font-weight: bold; font-size: 12px;">Password:</label>
                            <input type="password" STYLE="color: #7785AC; font-family: sans-serif; font-weight: bold; font-size: 12px; background-color: #CCD7C5;" id="rpass" name="pwd"><br><br>
-->
                            <button class="btn waves-effect waves-light" type="submit" name="action" onclick="register()">Register User</button>
                        </div>
                    </td>
                    <td>
                        <div id ="login">
                            <span class="input-group-text" id="inputGroup-sizing-default">User ID</span>
                            <input type="text" class="form-control" id="luname" name="fname" aria-describedby="inputGroup-sizing-default">
                            <span class="input-group-text" id="inputGroup-sizing-default">Password</span>
                            <input type="password" class="form-control" id="lpass" name="pwd" aria-describedby="inputGroup-sizing-default">
                            
<!--
                            <label for="luname" style="color:#028090; font-family: sans-serif; font-weight: bold; font-size: 12px;">UserID:</label>
                            <input type="text" STYLE="color: #7785AC; font-family: sans-serif; font-weight: bold; font-size: 12px; background-color: #CCD7C5;" id="luname" name="fname"><br><br>
                            <label for="lpass" style="color:#028090; font-family: sans-serif; font-weight: bold; font-size: 12px;">Password:</label>
                            <input type="password" STYLE="color: #7785AC; font-family: sans-serif; font-weight: bold; font-size: 12px; background-color: #CCD7C5;" id="lpass" name="pwd"><br><br>
-->
                            <button class="btn waves-effect waves-light" type="submit" name="action" onclick="login()">Enter</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div id="full">
            <div class="container">
                <div class="row">
                    <div class="col" id = "divtweet">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Please input your Tweet here</span>
                            <input type="text" class="form-control" id="tweet" name="tweet" aria-describedby="inputGroup-sizing-default">
                        </div>
                        <button class="btn waves-effect waves-light" type="submit" name="tweet" onclick="tweet()">Send Tweet</button>
                    </div>
                    <br>

                    <div class="col" id = "divfollower">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Which User Do You Wish To Follow?</span>
                            <input type="text" class="form-control" id="follower" name="follower" aria-describedby="inputGroup-sizing-default">
                        </div>
                        <button class="btn waves-effect waves-light" type="submit" name="follow" onclick="follow()">Follow User</button>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col" id = "GetTweets">
                        <div class="form-floating">
                            <textarea class="form-control" placeholder="Leave a comment here" id="gettweets" name="gettweets" style="height: 100px" disabled></textarea>
                            <label for="gettweets">Tweets</label>
                        </div>
                        <div id ="dtweets"></div>
                        <button class="btn waves-effect waves-light" type="submit" name="gettweets" onclick="gettweets()">Tweets</button>
                    </div>
                    <div class="col" id = "GetMentions">
                        <div class="form-floating">
                            <textarea class="form-control" placeholder="Leave a comment here" id="getmentions" name="getmentions" style="height: 100px" disabled></textarea>
                            <label for="getmentions">Mentions</label>
                        </div>
                        <button class="btn waves-effect waves-light" type="submit" name="getmentions" onclick="getmentions()">Your Mentions</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col" id = "GetHashTags">
                        <div class="form-floating">
                            <textarea class="form-control" placeholder="Leave a comment here" id="gethashtags" name="gethashtags" style="height: 100px" disabled></textarea>
                            <label for="gethashtags">HashTags</label>
                        </div>
                                    
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="inputGroup-sizing-default">Search HashTags</span>
                            <input type="text" class="form-control" id="hashtag" name="hashtag" aria-describedby="inputGroup-sizing-default">
                        </div>
                        <button class="btn waves-effect waves-light" type="submit" name="gethashtags" onclick="gethashtags()">Search HashTags</button>
                    </div>
                    <div class="col" id="output">
                        <h3 STYLE="color: #7785AC;">Timeline</h3>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <script type="text/javascript">
        var username = ""
        function loadEnter(){
            
            document.getElementById("full").style.display="none";
            document.getElementById("logouthead").style.display="none";
            document.getElementById("homepage").style.display="block";
            clearinput();
        }
        function userload(){
            
            document.getElementById("full").style.display="block";
            document.getElementById("logouthead").style.display="block";
            document.getElementById("homepage").style.display="none";
            clearinput();
        }
        function clearinput(){
            var elements = document.getElementsByTagName("input");
            for (var ii=0; ii < elements.length; ii++) {
                elements[ii].value = "";
            }   
            elements = document.getElementsByTagName("textarea");
            for (var ii=0; ii < elements.length; ii++) {
                elements[ii].value = "";
            }
        }
        function register(){
            var url = "http://127.0.0.1:8080/register";
            var uname = document.getElementById("runame").value;
            var pwd = document.getElementById("rpass").value;
            var data = JSON.stringify({'UserName':uname,"Password":pwd});
            clearinput();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                dataType: "json",
                success: function(data){
                    if(data.error){
                        
                    }else{
                    }
                    alert(data.Comment);
                    
                }
            });
            
            
        }
        function login(){
            var url = "http://127.0.0.1:8080/login";
            var uname = document.getElementById("luname").value;
            var pwd = document.getElementById("lpass").value;
            var data = JSON.stringify({'UserName':uname,"Password":pwd});
            clearinput();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                dataType: "json",
                success: function(data){
                    if(data.error){
                        if(data.status == 0){
                            alert(data.Comment);
                        }else{
                            username = uname;
                            startWebSocket();
                            userload();
                        }
                    }else{
                        username = uname;
                        startWebSocket();
                        userload();
                    }
                    
                }
            });
            console.log(username)
        }
        function logout(){
            var url = "http://127.0.0.1:8080/logout";
            var data = JSON.stringify({'UserName':username});
            clearinput();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                dataType: "json",
                success: function(data){
                    if(data.error){
                    }else{
                        
                    }
                    loadEnter();
                    username = "";
                }
            });
        }
        function tweet(){
            var url = "http://127.0.0.1:8080/newtweet";
            var tweett = document.getElementById("tweet").value;
            var data = JSON.stringify({'Tweet':tweett,'UserName':username});
            clearinput();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                dataType: "json",
                success: function(data){
                    
                    if(data.error){
                        alert(data.Comment);
                        if(data.status < 2){
                            loadEnter();
                        }
                    }else{ 
                    }
                   
                    
                }
            });
        }
        function follow(){
            var url = "http://127.0.0.1:8080/follow";
            var following = document.getElementById("follower").value;
            var data = JSON.stringify({'UserName':username,"Following":following});
            clearinput();
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                dataType: "json",
                success: function(data){
                    
                    if(data.error){
                        alert(data.Comment);
                        if(data.status < 2){
                            loadEnter();
                        } 
                    }else{
                    }
                    
                }
            });
        }
        function gethashtags(){
            var hashtag = document.getElementById("hashtag").value;
            var url = "http://127.0.0.1:8080/gethashtags/"+username+"/"+hashtag;
            clearinput();
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function(data){
                    
                    if(data.error){
                        alert(data.Comment);
                        if(data.status < 2){
                            loadEnter();
                        }
                    }else{
                        var text = "";
                        for (i=0;i<data.Content.length;i++){
                            text += data.Content[i]+"\n"
                        }
                        document.getElementById("gethashtags").value = text
                    }
                    
                    
                }
            });
        }
        function getmentions(){
            var url = "http://127.0.0.1:8080/getmentions/"+username;
            clearinput();
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function(data){
                    if(data.error){
                        alert(data.Comment);
                        if(data.status < 2){
                            loadEnter();
                        } 
                    }else{
                        var text = "";
                        for (i=0;i<data.Content.length;i++){
                            text += data.Content[i]+"\n"
                        }
                        document.getElementById("getmentions").value = text
                    }
                    
                    
                }
            });
        }
        function gettweets(){
            var url = "http://127.0.0.1:8080/gettweets/"+username;
            clearinput();
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function(data){
                    if(data.error){
                        alert(data.Comment);
                        if(data.status < 2){
                            loadEnter();
                        }
                    }else{
                        var text = "";
                        for (i=0;i<data.Content.length;i++){
                            text += data.Content[i]+"\n";
                        }
                        document.getElementById("gettweets").value = text
                    }
                    
                    
                }
            });
        }
        var output;
        function startWebSocket(){
            var wsUri = "ws://localhost:8080/websocket";
            websocket = new WebSocket(wsUri);
            output = document.getElementById("output");
            websocket.onopen = function(evt) { onOpen(evt) };
            websocket.onclose = function(evt) { onClose(evt) };
            websocket.onmessage = function(evt) { onMessage(evt) };
            websocket.onerror = function(evt) { onError(evt) };
        }
        function onOpen(evt)
        {
            writeToScreen('<span style="color: #8D0801;"> ' + "Server connection sucessful!" +'</span>');
            var message = "UserName:"+username;
            doSend(message);
        }

        function onClose(evt)
        {
            writeToScreen('<span style="color: #8D0801;"> ' + "Server disconnected sucessfully!" + '</span>');
        }

        function onMessage(evt)
        {
            writeToScreen('<span style="color: orange;"> ' + evt.data+'</span>');
        }

        function onError(evt)
        {
            writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
        }

        function doSend(message)
        {
            console.log("sending"+message) ;
            websocket.send(message);
        }

        function writeToScreen(message)
        {
            var pre = document.createElement("p");
            pre.style.wordWrap = "break-word";
            pre.innerHTML = message;
            output.appendChild(pre);
        }
    </script>
</body>
</html>